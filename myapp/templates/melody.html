<!DOCTYPE html>
<html>
<head>
    <title>äº”ç·šè­œå±•ç¤º</title>
    {% load static %}
    <meta name="csrf-token" content="{{ csrf_token }}">
    <style>
        #staff-container {
            width: window.innerWidth * 0.9;
            overflow-x: auto;
            display: flex;
            justify-content: center;
            padding: 20px;
        }
        canvas {
            display: block;
            border: 1px solid #ccc;
        }
    </style>
</head>
<body>
    <!-- ğŸ”— å›é¦–é é€£çµ -->
    <nav class="bg-white shadow p-4 flex justify-between">
        <a href="/" class="text-xl font-bold text-blue-600">ğŸµ éŸ³æ¨‚ç«™</a>
    </nav>

    <h1>äº”ç·šè­œé¡¯ç¤º Demo</h1>

    <button data-action="add">æ–°å¢å°ç¯€</button>

    <select id="note-select">
        é¸å–éŸ³è‰²
        <option>c</option><option>d</option><option>e</option>
        <option>f</option><option>g</option><option>a</option><option>b</option>
    </select>

    <select id="pitch-select">
        é¸å–éŸ³é«˜
        <option>3</option><option>4</option><option>5</option>
    </select>

    <select id="duration-select">
        é¸å–é•·åº¦
        <option>q</option>
        <option>ä¼‘æ­¢ç¬¦/qr</option>
    </select>

    <button data-action="Note-Set">è¨­å®šéŸ³ç¬¦</button>

    <div id="staff-container">
        <canvas id='score'></canvas>
    </div>

    <button id="export-midi">åŒ¯å‡º MIDI</button>
    <button id="download-midi" style="display:none;">ä¸‹è¼‰ MIDI</button>
    <button id="download-wav" style="display:none;">ä¸‹è¼‰ WAV</button>

    <!-- âœ… æ’­æ”¾æ•´éŸ³éš -->
    <button onclick="playScale()">æ’­æ”¾éŸ³éš</button>

    <!-- âœ… è¼‰å…¥ JS æ¨¡çµ„ -->
    <script type="module" src="{% static 'music_js/vexflow_demo.js' %}"></script>
    <script type="module" src="{% static 'music_js/export_midi.js' %}"></script>
    <script type="module" src="{% static 'music_js/player_bridge.js' %}"></script>

    <!-- âœ… Tone æ’­æ”¾é‚è¼¯ï¼ˆåŸºæœ¬ç¯„ä¾‹ï¼‰-->
    <script>
      async function playScale() {
        await Tone.start();
        const synth = new Tone.Synth().toDestination();
        const notes = ['C4', 'D4', 'E4', 'F4', 'G4', 'A4', 'B4', 'C5'];
        notes.forEach((note, i) => {
          synth.triggerAttackRelease(note, '8n', Tone.now() + i * 0.5);
        });
      }

      async function playMelody() {
        await Tone.start();
        const synth = new Tone.Synth().toDestination();
        const melody = [
          { time: 0, note: 'C4', duration: '8n' },
          { time: 0.5, note: 'D4', duration: '8n' },
          { time: 1.0, note: 'E4', duration: '8n' },
          { time: 1.5, note: 'F4', duration: '8n' },
        ];
        const part = new Tone.Part((time, value) => {
          synth.triggerAttackRelease(value.note, value.duration, time);
        }, melody).start(0);

        Tone.Transport.start();
      }
    </script>
</body>
</html>
